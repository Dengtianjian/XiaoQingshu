<!-- pages/class/class.wxml -->
<block wx:if="{{ pageLoadingCompleted }}">
  <block wx:if="{{ classInfo!=null }}">
    <NavigationBar pageScrollTop="{{ scrollTop }}" crititcal="{{ 80 }}" interval="{{ 20000 }}" defaultColor="#ffffff" hiddenReturnPage="{{ true }}" hiddenBackHome="{{ true }}">
      <view class="grade">{{ classInfo['grade'] }}Á∫ß</view>
      <view class="class-number-id">Áè≠Á∫ßÊï∞Â≠ó:{{ classInfo['_numberid'] }}</view>
    </NavigationBar>
    <view class="class-info">
      <view class="class-info-head">
        <view class="class-info-left" bind:tap="goToEditClass">
          <view class="class-name">
            {{ classInfo['profession'] }}{{ classInfo['number']||'' }}Áè≠
          </view>
          <text class="class-quit qcicon qcicon-tuichu" catch:tap="quitClass"></text>
        </view>
        <view class="class-info-right">
          <block wx:if="{{ newClassmate.has }}">
            <view class="class-new-classmate qcicon qcicon-smile" bindtap="displayNewClassmatePopup" data-flag="{{ false }}"></view>
            <Popup hidden="{{ newClassmate.hiddenPopup }}" position="bottom" customStyle="height:88%;">
              <view class="new-classmate-list">
                <block wx:for="{{ newClassmate.list }}" wx:key="index">
                  <view class="new-classmate-item" wx:if="{{ item!='deleted' }}">
                    <view class="new-classmate-item-info">
                      <image class="new-classmate-item-avatar" src="{{ item['avatar_url'] }}"></image>
                      <text class="new-classmate-item-nickname">{{ item['nickname'] }}</text>
                    </view>
                    <view class="new-classmate-item-operate">
                      <button class="new-classmate-item-operate-item" type="default" size="mini" bind:tap="rejectNewClassmateJoin" data-index="{{ index }}">
                        ÊãíÁªù
                      </button>
                      <button class="new-classmate-item-operate-item" type="primary" size="mini" bind:tap="agreeNewClassmateJoin" data-index="{{ index }}">
                        ÂêåÊÑè
                      </button>
                    </view>
                  </view>
                </block>
              </view>
            </Popup>
          </block>
          <button class="invite-classmate-button" open-type="share">
            <view class="invite-classmate qcicon qcicon-share"></view>
          </button>
        </view>
      </view>
      <StatisticsGrid class="class-statistics" statistics="{{ statistics }}" textAlign="left" countFontSize="32rpx" titleFontSize="20rpx" />
    </view>
    <view class="head-background">
      <swiper class="album-swiper" indicator-dots="{{false}}" autoplay="{{true}}" circular >
        <block wx:for="{{photos}}" wx:key="index">
          <swiper-item>
            <image class="album-swiper-item" src="{{ item._fileid }}" mode="aspectFill"></image>
          </swiper-item>
        </block>
      </swiper>
    </view>
    <view class="radius-container">
      <navigator open-type="navigate" hover-class="none" url="/subpages/class/album/album?classid={{ classInfo['_id'] }}">
        <view class="album-entry" >
          <image class="album-entry-images" src="/material/images/class_album_entry.png" mode="aspectFill" />
        </view>
        <!-- <view class="album-list" wx:else>
          <block wx:for="{{ photos }}" wx:key="index">
            <image class="album-item" src="{{ item._fileid }}" mode="aspectFill"></image>
          </block>
        </view> -->
      </navigator>
      <view class="classmate">
        <!-- <navigator class="classmate-item edit-my-info" hover-class="none" open-type="navigate" url="/subpages/class/edit_my_info/edit_my_info">
        ÁºñËæëÊàëÁöÑ‰ø°ÊÅØ
      </navigator> -->
        <view class="classmate-item" wx:for="{{ classmates }}" bindtap="displayClassmateInfo" data-index="{{ index }}" data-flag="{{ false }}" wx:key="index">
          <view class="classmater-item-left">
            <image class="classmater-item-avatar" src="{{ item['avatar_url'] }}" mode="aspectFill"></image>
            <view class="classmate-item-nickname">{{ item['realname']||item['nickname'] }}</view>
          </view>
          <text class="classmate-item-rightarrow qcicon qcicon-arrow-right"></text>
        </view>
        <view hidden="{{ classmateInfo.hiddenPopup }}">
          <view class="classmate-info-popup" catch:touchmove>
            <image class="classmate-info-avatar" src="{{ classmateInfo['info']['avatar_url'] }}" mode="top"></image>
            <view class="classmate-info-gender" wx:if="{{ classmateInfo['info']['gender']!='secret' }}">
              {{ classmateInfo['info']['gender']=='male'?'üßë':'üë©' }}
            </view>
            <view class="classmate-info-name">
              {{ classmateInfo['info']['realname']||classmateInfo['info']['nickname'] }}
            </view>
            <view class="classmate-info-list">
              <view class="classmate-info-item" wx:if="{{ classmateInfo['info']['phone_number'] }}">
                <view class="classmate-info-item-title">ÊâãÊú∫Âè∑Á†Å</view>
                <view class="classmate-info-item-content">
                  {{ classmateInfo['info']['phone_number'] }}
                </view>
              </view>
              <view class="classmate-info-item" wx:if="{{ classmateInfo['info']['birthday']!='' }}">
                <view class="classmate-info-item-title">Âπ¥ÈæÑ</view>
                <view class="classmate-info-item-content">{{ classmateInfo['info']['age'] }}</view>
              </view>
              <view class="classmate-info-item" wx:if="{{ classmateInfo['info']['birthday']!='' }}">
                <view class="classmate-info-item-title">ÁîüÊó•</view>
                <view class="classmate-info-item-content">
                  {{ classmateInfo['info']['birthday'] }}
                </view>
              </view>
            </view>
          </view>
        </view>
        <view class="classmate-info-popup-mask" catch:touchmove hidden="{{ classmateInfo['hiddenPopup'] }}" bindtap="displayClassmateInfo" data-flag="{{ true }}"></view>
      </view>
    </view>
  </block>
  <block wx:if="{{ userIsLogin===false }}">
    <NavigationBar pageTitle="Áè≠Á∫ß" hiddenReturnPage="{{ true }}" hiddenBackHome="{{ true }}" />
    <PagePrompt class="page-prompt" icon="/material/images/not_logged.png" description="ËøòÊú™ÁôªÂΩïÂì¶ÔºåÁôªÂΩïÂêéÊâçÂèØ‰ª•Êü•ÁúãËá™Â∑±ÊâÄÂú®ÁöÑÁè≠Á∫ßÂë¢">
      <view class="page-prompt-operate">
        <button class="button-common" type="primary" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
          ÁôªÂΩï
        </button>
      </view>
    </PagePrompt>
  </block>
  <block wx:if="{{ userIsLogin&&classInfo==null }}">
    <NavigationBar pageTitle="Áè≠Á∫ß" hiddenReturnPage="{{ true }}" hiddenBackHome="{{ true }}" />
    <PagePrompt class="page-prompt" icon="/material/images/not_class.png" description="ËøòÊú™Âä†ÂÖ•‰ªª‰Ωï‰∏Ä‰∏™Áè≠Á∫ßÂì¶ÔºåËØ∑ÈÄöËøáÂ•ΩÂèãÈÇÄËØ∑ÊàñËÄÖËæìÂÖ•Áè≠Á∫ßIDÁî≥ËØ∑Âä†ÂÖ•Âêß">
      <form class="not-class-form page-prompt-operate" bindsubmit="searchClass">
        <input class="not-class-form-el" type="number" name="class_id" placeholder="Áè≠Á∫ßID" />
        <button class="not-class-form-submit button-common" type="primary" form-type="submit">
          ÊêúÁ¥¢
        </button>
        <view class="create-class-entry" bind:tap="goToEditClass">ÂàõÂª∫Áè≠Á∫ß</view>
      </form>
    </PagePrompt>
    <Dialog hidden="{{ joinClass['hiddenPopup'] }}" title="Ê†πÊçÆIDÊü•ËØ¢Âà∞‰∫Ü" height="440rpx" cancelButton="‰∏çÊòØËøô‰∏™" confirmButton="ÊòØÁöÑÔºåÁî≥ËØ∑Âä†ÂÖ•" textAlign="center" bind:cancel="hiddenJoinClassDialog" bind:confirm="confirmJoinClass">
      <view slot="content">
        {{ joinClass['searchResult']['school']['name'] }}
        <view>
          {{ joinClass['searchResult']['grade'] }}Á∫ß {{ joinClass['searchResult']['profession'] }}{{ joinClass['searchResult']['number'] }}Áè≠
        </view>
      </view>
    </Dialog>
  </block>
</block>